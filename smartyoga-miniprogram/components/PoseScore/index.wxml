<!-- components/PoseScore/index.wxml -->
<view class="pose-score {{darkMode ? 'dark' : ''}}">
  <!-- éª¨æ¶å›¾ Canvas -->
  <view class="canvas-container">
    <canvas 
      canvas-id="skeletonCanvas" 
      class="canvas"
      style="width: {{imgWidth}}rpx; height: {{imgHeight}}rpx;"
      bindtouchstart="onCanvasTouch"
      disable-scroll="{{true}}"
    ></canvas>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="canvas-loading">
      <view class="loading-spinner"></view>
      <text class="loading-text">AI åˆ†æä¸­</text>
    </view>
    
    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:if="{{error}}" class="canvas-error" bindtap="onRetry">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{error}}</text>
      <text class="retry-hint">ç‚¹å‡»é‡è¯•</text>
    </view>
    
    <!-- Canvas é®ç½©å±‚ï¼ˆæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼‰ -->
    <view wx:if="{{!loading && !error && keypoints.length > 0}}" class="canvas-overlay">
      <view class="keypoint-stats">
        <text class="stat-item">{{validKeypoints}}/{{totalKeypoints}} ç‚¹</text>
        <text class="stat-item">{{avgConfidence}}% ç²¾åº¦</text>
      </view>
    </view>
  </view>

  <!-- åˆ†æ•°åŒºåŸŸ -->
  <view class="score-section">
    <!-- å§¿åŠ¿åç§°å’Œåˆ†æ•° -->
    <view class="score-header">
      <view class="pose-info">
        <text class="pose-name">{{poseName || 'æœªçŸ¥å§¿åŠ¿'}}</text>
        <text wx:if="{{processingTime > 0}}" class="processing-time">{{processingTime}}ms</text>
      </view>
      <view class="score-badge score-{{scoreLevel}}">
        <text class="score-value">{{displayScore}}</text>
        <text class="score-unit">åˆ†</text>
      </view>
    </view>
    
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-container">
      <view class="progress-bg">
        <view 
          class="progress-bar score-{{scoreLevel}}"
          style="width: {{score}}%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);"
        ></view>
        <view class="progress-glow score-{{scoreLevel}}" style="left: {{score}}%;"></view>
      </view>
      <view class="score-labels">
        <text class="label-left">0</text>
        <text class="label-center">50</text>
        <text class="label-right">100</text>
      </view>
    </view>
    
    <!-- åˆ†æ•°ç­‰çº§è¯´æ˜ -->
    <view class="score-description">
      <text class="score-level-text">{{scoreDescription}}</text>
      <view wx:if="{{score >= 85}}" class="score-emoji">ğŸ‰</view>
      <view wx:elif="{{score >= 70}}" class="score-emoji">ğŸ‘</view>
      <view wx:elif="{{score >= 50}}" class="score-emoji">ğŸ’ª</view>
      <view wx:else class="score-emoji">ğŸŒ±</view>
    </view>
  </view>

  <!-- AI å»ºè®®åŒºåŸŸ -->
  <view wx:if="{{advice}}" class="advice-section">
    <view class="advice-header">
      <text class="advice-icon">ğŸ¤–</text>
      <text class="advice-title">AI ä¸“ä¸šå»ºè®®</text>
    </view>
    <view class="advice-content">
      <text class="advice-text">{{advice}}</text>
    </view>
  </view>
  
  <!-- è¯¦ç»†æ•°æ®ï¼ˆå¯æŠ˜å ï¼‰ -->
  <view wx:if="{{showDetails}}" class="details-section">
    <view class="details-header" bindtap="toggleDetails">
      <view class="details-title-wrapper">
        <text class="details-icon">ğŸ“Š</text>
        <text class="details-title">æ£€æµ‹è¯¦æƒ…</text>
      </view>
      <view class="details-toggle {{detailsExpanded ? 'expanded' : ''}}">
        <text class="toggle-text">{{detailsExpanded ? 'æ”¶èµ·' : 'å±•å¼€'}}</text>
        <text class="toggle-arrow">{{detailsExpanded ? 'â–²' : 'â–¼'}}</text>
      </view>
    </view>
    
    <view wx:if="{{detailsExpanded}}" class="details-content">
      <view class="detail-grid">
        <view class="detail-item">
          <text class="detail-label">æ£€æµ‹ç‚¹æ•°</text>
          <text class="detail-value">{{validKeypoints}}/{{totalKeypoints}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¹³å‡ç½®ä¿¡åº¦</text>
          <text class="detail-value">{{avgConfidence}}%</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¤„ç†æ—¶é—´</text>
          <text class="detail-value">{{processingTime}}ms</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å§¿åŠ¿ç­‰çº§</text>
          <text class="detail-value score-{{scoreLevel}}">{{scoreLevel.toUpperCase()}}</text>
        </view>
      </view>
      
      <!-- å…³é”®ç‚¹ç½®ä¿¡åº¦åˆ†å¸ƒ -->
      <view wx:if="{{keypoints.length > 0}}" class="confidence-distribution">
        <text class="distribution-title">å…³é”®ç‚¹ç½®ä¿¡åº¦åˆ†å¸ƒ</text>
        <view class="confidence-bars">
          <view 
            wx:for="{{keypoints}}" 
            wx:key="index"
            wx:if="{{item && item.score >= 0.1}}"
            class="confidence-bar"
          >
            <view 
              class="confidence-fill"
              style="height: {{item.score * 100}}%; background: {{item.score > 0.7 ? '#22c55e' : item.score > 0.4 ? '#3b82f6' : '#f59e0b'}};"
            ></view>
          </view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button wx:if="{{error}}" class="retry-button" bindtap="onRetry">
      <text class="button-icon">ğŸ”„</text>
      <text class="button-text">é‡æ–°æ£€æµ‹</text>
    </button>
    <button wx:else class="export-button" bindtap="exportCanvas">
      <text class="button-icon">ğŸ“·</text>
      <text class="button-text">ä¿å­˜éª¨æ¶å›¾</text>
    </button>
  </view>
</view>